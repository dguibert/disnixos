{ networkFiles
, nixpkgs ? <nixpkgs>
, nixos ? <nixos>
}:

let
  pkgs = import nixpkgs {};
  servicesNix = @prefix@/share/disnixos/services.nix.in;
in
pkgs.stdenv.mkDerivation {
  name = "services.nix";
  buildCommand = ''
    sed -e "s|@networkFiles@|${toString networkFiles}|" \
        -e "s|@nixpkgs@|${nixpkgs}|" \
	-e "s|@nixos@|${nixos}|" ${servicesNix} > $out
  '';
}
